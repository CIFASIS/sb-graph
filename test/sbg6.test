// Matching test, RC circuit with variables iR, vA, vB, der(vC)

N = 10000

F1 = 1
F2 = N+F1
F3 = N+F2
F4 = N-1+F3
F5 = N-1+F4
F6 = 1+F5
U1 = N+F6
U2 = N+U1
U3 = N+U2
U4 = N+U3

E1 = 1
E2 = N+E1
E3 = N+E2
E4 = N+E3
E5 = N+E4
E6 = N-1+E5
E7 = N-1+E6
E8a = N-1+E7
E8b = N-1+E8a
E9 = N-1+E8b
E10 = 1+E9
E11 = 1+E10

off1b = 4*N
off2b = 4*N-1
off3d = N
off3b = off2b
off4d = N
off4b = 2*N-1
off5d = 2*N
off5b = 3*N-1
off6d = 2*N
off6b = N
off7d = 3*N-1
off7b = N+1
off8ad = 3*N-1
off8ab = 2*N-1
off8bd = 4*N-2
off8bb = 3*N-3
off9d = 5*N-3
off9b = N-3
off10d = 5*N-3
off10b = 4*N-3
off11d = 5*N-2
off11b = N-2

V %= {[1:1:F1], [F1+1:1:F2], [F2+1:1:F3], [F3+1:1:F4], [F4+1:1:F5], [F5+1:1:F6], [F6+1:1:U1] 
  , [U1+1:1:U2], [U2+1:1:U3], [U3+1:1:U4]};
Vmap %= <<{[1:1:F1]} -> 0*x+1, {[F1+1:1:F2]} -> 0*x+2, {[F2+1:1:F3]} -> 0*x+3, {[F3+1:1:F4]} -> 0*x+4
  , {[F4+1:1:F5]} -> 0*x+5, {[F5+1:1:F6]} -> 0*x+6, {[F6+1:1:U1]} -> 0*x+7
  , {[U1+1:1:U2]} -> 0*x+8, {[U2+1:1:U3]} -> 0*x+9, {[U3+1:1:U4]} -> 0*x+10>>;
map1 %= <<{[1:1:E1]} -> 1*x+0, {[E1+1:1:E2]} -> 1*x+0, {[E2+1:1:E3]} -> 1*x-off3d
  , {[E3+1:1:E4]} -> 1*x-off4d, {[E4+1:1:E5]} -> 1*x-off5d, {[E5+1:1:E6]} -> 1*x-off6d
  , {[E6+1:1:E7]} -> 1*x-off7d, {[E7+1:1:E8a]} -> 1*x-off8ad, {[E8a+1:1:E8b]} -> 1*x-off8bd
  , {[E8b+1:1:E9]} -> 1*x-off9d, {[E9+1:1:E10]} -> 1*x-off10d, {[E10+1:1:E11]} -> 1*x-off11d>>;
map2 %= <<{[1:1:E1]} -> 1*x+off1b, {[E1+1:1:E2]} -> 1*x+off2b, {[E2+1:1:E3]} -> 1*x+off3b
  , {[E3+1:1:E4]} -> 1*x+off4b, {[E4+1:1:E5]} -> 1*x+off5b, {[E5+1:1:E6]} -> 1*x+off6b
  , {[E6+1:1:E7]} -> 1*x+off7b, {[E7+1:1:E8a]} -> 1*x-off8ab, {[E8a+1:1:E8b]} -> 1*x-off8bb
  , {[E8b+1:1:E9]} -> 1*x-off9b, {[E9+1:1:E10]} -> 1*x-off10b, {[E10+1:1:E11]} -> 1*x-off11b>>;
Emap %= <<{[1:1:E1]} -> 0*x+1, {[E1+1:1:E2]} -> 0*x+2, {[E2+1:1:E3]} -> 0*x+3
  , {[E3+1:1:E4]} -> 0*x+4, {[E4+1:1:E5]} -> 0*x+5, {[E5+1:1:E6]} -> 0*x+6
  , {[E6+1:1:E7]} -> 0*x+7, {[E7+1:1:E8a], [E8a+1:1:E8b]} -> 0*x+8, {[E8b+1:1:E9]} -> 0*x+9
  , {[E9+1:1:E10]} -> 0*x+10, {[E10+1:1:E11]} -> 0*x+11>>;

matching(
  V %= {[1:1:F1], [F1+1:1:F2], [F2+1:1:F3], [F3+1:1:F4], [F4+1:1:F5], [F5+1:1:F6], [F6+1:1:U1] 
    , [U1+1:1:U2], [U2+1:1:U3], [U3+1:1:U4]};
  Vmap %= <<{[1:1:F1]} -> 0*x+1, {[F1+1:1:F2]} -> 0*x+2, {[F2+1:1:F3]} -> 0*x+3, {[F3+1:1:F4]} -> 0*x+4
    , {[F4+1:1:F5]} -> 0*x+5, {[F5+1:1:F6]} -> 0*x+6, {[F6+1:1:U1]} -> 0*x+7
    , {[U1+1:1:U2]} -> 0*x+8, {[U2+1:1:U3]} -> 0*x+9, {[U3+1:1:U4]} -> 0*x+10>>;
  map1 %= <<{[1:1:E1]} -> 1*x+0, {[E1+1:1:E2]} -> 1*x+0, {[E2+1:1:E3]} -> 1*x-off3d
    , {[E3+1:1:E4]} -> 1*x-off4d, {[E4+1:1:E5]} -> 1*x-off5d, {[E5+1:1:E6]} -> 1*x-off6d
    , {[E6+1:1:E7]} -> 1*x-off7d, {[E7+1:1:E8a]} -> 1*x-off8ad, {[E8a+1:1:E8b]} -> 1*x-off8bd
    , {[E8b+1:1:E9]} -> 1*x-off9d, {[E9+1:1:E10]} -> 1*x-off10d, {[E10+1:1:E11]} -> 1*x-off11d>>;
  map2 %= <<{[1:1:E1]} -> 1*x+off1b, {[E1+1:1:E2]} -> 1*x+off2b, {[E2+1:1:E3]} -> 1*x+off3b
    , {[E3+1:1:E4]} -> 1*x+off4b, {[E4+1:1:E5]} -> 1*x+off5b, {[E5+1:1:E6]} -> 1*x+off6b
    , {[E6+1:1:E7]} -> 1*x+off7b, {[E7+1:1:E8a]} -> 1*x-off8ab, {[E8a+1:1:E8b]} -> 1*x-off8bb
    , {[E8b+1:1:E9]} -> 1*x-off9b, {[E9+1:1:E10]} -> 1*x-off10b, {[E10+1:1:E11]} -> 1*x-off11b>>;
  Emap %= <<{[1:1:E1]} -> 0*x+1, {[E1+1:1:E2]} -> 0*x+2, {[E2+1:1:E3]} -> 0*x+3
    , {[E3+1:1:E4]} -> 0*x+4, {[E4+1:1:E5]} -> 0*x+5, {[E5+1:1:E6]} -> 0*x+6
    , {[E6+1:1:E7]} -> 0*x+7, {[E7+1:1:E8a], [E8a+1:1:E8b]} -> 0*x+8, {[E8b+1:1:E9]} -> 0*x+9
    , {[E9+1:1:E10]} -> 0*x+10, {[E10+1:1:E11]} -> 0*x+11>>;
  , 1
)
