/*
model testRL3
  //iR[i] and iR[i+1] can be computed out of each other
  //uL[i] and uL[i+1] can be computed out of each other
  //All variables form a large algebraic loop

  constant Integer N=5;
  Real iL[N],iR[N],uL[N];
  parameter Real L=1,R=1,L1=1,U=1,R0=1;
equation
  for i in 1:N loop
    L*der(iL[i])=uL[i]; // der(iL[1:N])
  end for;  
  for i in 1:N-1 loop
    iR[i]-iR[i+1]-iL[i]=0; // iR[2:N]
    uL[i]-uL[i+1]-R*iR[i+1]=0; // uL[1:N-1]
  end for;  
  U-uL[1]-R*iR[1]=0; // iR[1]
  uL[N]-(iR[N]-iL[N])*R0=0; // uL[N]
end testRL3;
*/

N = 100000

V1 = N
V2 = N-1+V1
V3 = N-1+V2
V4 = 1+V3
V5 = 1+V4

E1 = N-1 // V1 - V3
E2 = 1+E1 // V1 - V5
E3 = N-2+E2 // V2 - V2
E4 = 1+E3 // V2 - V4
E5 = N-1+E4 // V3 - V2
E6 = N-2+E5 // V3 - V3
E7 = 1+E6 // V3 - V5
E8 = 1+E7 // V4 - V3
E9 = 1+E8 // V5 - V2

off1d = r(V3, 1)-r(E1, 1)
off2d = r(V5, 1)-r(E2, 1)
off3d = r(V2, 1)-r(E3, 1)-1
off4d = r(V4, 1)-r(E4, 1)
off5d = r(V2, 1)-r(E5, 1)
off6d = r(V3, 1)-r(E6, 1)
off7d = r(V5, 1)-r(E7, 1)
off8d = r(V3, 1)-r(E8, 1)-N+2
off9d = r(V2, 1)-r(E9, 1)

off1b = r(V1, 1)-r(E1, 1)-1
off2b = r(V1, 1)-r(E2, 1)
off3b = r(V2, 1)-r(E3, 1)
off4b = r(V2, 1)-r(E4, 1)-N+2
off5b = r(V3, 1)-r(E5, 1)
off6b = r(V3, 1)-r(E6, 1)-1
off7b = r(V3, 1)-r(E7, 1)
off8b = r(V4, 1)-r(E8, 1)
off9b = r(V5, 1)-r(E9, 1)

V %= {[1:1:V1], [V1+1:1:V2], [V2+1:1:V3], [V3+1:1:V4], [V4+1:1:V5]};
Vmap %= <<{[1:1:V1]} -> 0*x+1, {[V1+1:1:V2]} -> 0*x+2, {[V2+1:1:V3]} -> 0*x+3
  , {[V3+1:1:V4]} -> 0*x+4, {[V4+1:1:V5]} -> 0*x+5>>;
mapB %= <<{[1:1:E1]} -> 1*x+off1b, {[E1+1:1:E2]} -> 1*x+off2b, {[E2+1:1:E3]} -> 1*x+off3b
  , {[E3+1:1:E4]} -> 1*x+off4b, {[E4+1:1:E5]} -> 1*x+off5b, {[E5+1:1:E6]} -> 1*x+off6b
  , {[E6+1:1:E7]} -> 1*x+off7b, {[E7+1:1:E8]} -> 1*x+off8b, {[E8+1:1:E9]} -> 1*x+off9b>>;
mapD %= <<{[1:1:E1]} -> 1*x+off1d, {[E1+1:1:E2]} -> 1*x+off2d, {[E2+1:1:E3]} -> 1*x+off3d
  , {[E3+1:1:E4]} -> 1*x+off4d, {[E4+1:1:E5]} -> 1*x+off5d, {[E5+1:1:E6]} -> 1*x+off6d
  , {[E6+1:1:E7]} -> 1*x+off7d, {[E7+1:1:E8]} -> 1*x+off8d, {[E8+1:1:E9]} -> 1*x+off9d>>;
Emap %= <<{[1:1:E1]} -> 0*x+1, {[E1+1:1:E2]} -> 0*x+2, {[E2+1:1:E3]} -> 0*x+3
  , {[E3+1:1:E4]} -> 0*x+4, {[E4+1:1:E5]} -> 0*x+5, {[E5+1:1:E6]} -> 0*x+6
  , {[E6+1:1:E7]} -> 0*x+7, {[E7+1:1:E8]} -> 0*x+8, {[E8+1:1:E9]} -> 0*x+9>>;

scc(
V %= {[1:1:V1], [V1+1:1:V2], [V2+1:1:V3], [V3+1:1:V4], [V4+1:1:V5]};
Vmap %= <<{[1:1:V1]} -> 0*x+1, {[V1+1:1:V2]} -> 0*x+2, {[V2+1:1:V3]} -> 0*x+3
  , {[V3+1:1:V4]} -> 0*x+4, {[V4+1:1:V5]} -> 0*x+5>>;
mapB %= <<{[1:1:E1]} -> 1*x+off1b, {[E1+1:1:E2]} -> 1*x+off2b, {[E2+1:1:E3]} -> 1*x+off3b
  , {[E3+1:1:E4]} -> 1*x+off4b, {[E4+1:1:E5]} -> 1*x+off5b, {[E5+1:1:E6]} -> 1*x+off6b
  , {[E6+1:1:E7]} -> 1*x+off7b, {[E7+1:1:E8]} -> 1*x+off8b, {[E8+1:1:E9]} -> 1*x+off9b>>;
mapD %= <<{[1:1:E1]} -> 1*x+off1d, {[E1+1:1:E2]} -> 1*x+off2d, {[E2+1:1:E3]} -> 1*x+off3d
  , {[E3+1:1:E4]} -> 1*x+off4d, {[E4+1:1:E5]} -> 1*x+off5d, {[E5+1:1:E6]} -> 1*x+off6d
  , {[E6+1:1:E7]} -> 1*x+off7d, {[E7+1:1:E8]} -> 1*x+off8d, {[E8+1:1:E9]} -> 1*x+off9d>>;
Emap %= <<{[1:1:E1]} -> 0*x+1, {[E1+1:1:E2]} -> 0*x+2, {[E2+1:1:E3]} -> 0*x+3
  , {[E3+1:1:E4]} -> 0*x+4, {[E4+1:1:E5]} -> 0*x+5, {[E5+1:1:E6]} -> 0*x+6
  , {[E6+1:1:E7]} -> 0*x+7, {[E7+1:1:E8]} -> 0*x+8, {[E8+1:1:E9]} -> 0*x+9>>;
)
