// Topological sort test corresponding to the following model:

/*
model test
  constant Integer N=10;
  Real a[N], b[N-1], c[N-1];
equation
  for i in 1:N-1 loop
    a[i] = a[i+1] - (b[i] + c[i]);
    b[i] = k1*a[i+1];
    c[i] = k2*a[i+1];
  end for;
  a[N] = 1000;
end test;
*/

N = 10

V1 = N
V2 = N-1+V1
V3 = N-1+V2

E1 = N-1
E2 = N-1+E1
E3 = N-1+E2
E4 = N-1+E3
E5 = N-1+E4

off1b = r(V1, 1)-r(E1, 1)-1
off2b = r(V1, 1)-r(E2, 1)-1
off3b = r(V1, 1)-r(E3, 1)-1
off4b = r(V2, 1)-r(E4, 1)
off5b = r(V3, 1)-r(E5, 1)

off1d = r(V1, 1)-r(E1, 1)
off2d = r(V2, 1)-r(E2, 1)
off3d = r(V3, 1)-r(E3, 1)
off4d = r(V1, 1)-r(E4, 1)
off5d = r(V1, 1)-r(E5, 1)

V %= {[1:1:V1], [V1+1:1:V2], [V2+1:1:V3]};
Vmap %= <<{[1:1:V1-1]} -> 0*x+1, {[V1:1:V1]} -> 0*x+2, {[V1+1:1:V2]} -> 0*x+3
  , {[V2+1:1:V3]} -> 0*x+4>>;
mapB %= <<{[1:1:E1]} -> 1*x+off1b, {[E1+1:1:E2]} -> 1*x+off2b, {[E2+1:1:E3]} -> 1*x+off3b
  , {[E3+1:1:E4]} -> 1*x+off4b, {[E4+1:1:E5]} -> 1*x+off5b>>;
mapD %= <<{[1:1:E1]} -> 1*x+off1d, {[E1+1:1:E2]} -> 1*x+off2d, {[E2+1:1:E3]} -> 1*x+off3d
  , {[E3+1:1:E4]} -> 1*x+off4d, {[E4+1:1:E5]} -> 1*x+off5d>>;
Emap %= <<{[1:1:E1]} -> 0*x+1, {[E1+1:1:E2]} -> 0*x+2, {[E2+1:1:E3]} -> 0*x+3
  , {[E3+1:1:E4]} -> 0*x+4, {[E4+1:1:E5]} -> 0*x+5>>;

sort(
V %= {[1:1:V1], [V1+1:1:V2], [V2+1:1:V3]};
Vmap %= <<{[1:1:V1-1]} -> 0*x+1, {[V1:1:V1]} -> 0*x+2, {[V1+1:1:V2]} -> 0*x+3
  , {[V2+1:1:V3]} -> 0*x+4>>;
mapB %= <<{[1:1:E1]} -> 1*x+off1b, {[E1+1:1:E2]} -> 1*x+off2b, {[E2+1:1:E3]} -> 1*x+off3b
  , {[E3+1:1:E4]} -> 1*x+off4b, {[E4+1:1:E5]} -> 1*x+off5b>>;
mapD %= <<{[1:1:E1]} -> 1*x+off1d, {[E1+1:1:E2]} -> 1*x+off2d, {[E2+1:1:E3]} -> 1*x+off3d
  , {[E3+1:1:E4]} -> 1*x+off4d, {[E4+1:1:E5]} -> 1*x+off5d>>;
Emap %= <<{[1:1:E1]} -> 0*x+1, {[E1+1:1:E2]} -> 0*x+2, {[E2+1:1:E3]} -> 0*x+3
  , {[E3+1:1:E4]} -> 0*x+4, {[E4+1:1:E5]} -> 0*x+5>>;
)
