/*
model Test1
  constant Integer N = 100;
  Real a[N], b[N], x[N];
equation
  for i in 1:N loop
    a[i] = 2 * x[i] - b[i];
    a[i] = 2 * b[i] - x[i];
    der(x[i]) = 1 - a[i];
  end for;  
end Test1;
*/

/* Ordered model:

model Test1
  constant Integer N = 100;
  Real a[N], b[N], x[N];
equation
  for i in 1:N loop
    a[i] = 2*x[i] - b[i]; // (1)
    b[i] = 0.5*(a[i] + x[i]); // (1)
  end for;
  der(x[i]) = 1 - a[i];
end Test1;
*/

N = 100

F1 = N
F2 = N+F1
F3 = N+F2
U1 = N+F3
U2 = N+U1
U3 = N+U2

E1 = N // F1 - a[i]
E2 = N+E1 // F1 - b[i]
E3 = N+E2 // F2 - a[i]
E4 = N+E3 // F2 - b[i]
E5 = N+E4 // F3 - a[i]
E6 = N+E5 // F3 - der(x[i])

off1d = 0
off2d = r(F1, 1)-r(E2, 1)
off3d = r(F2, 1)-r(E3, 1)
off4d = r(F2, 1)-r(E4, 1)
off5d = r(F3, 1)-r(E5, 1)
off6d = r(F3, 1)-r(E6, 1)

off1b = r(U1, 1)-r(E1, 1)
off2b = r(U2, 1)-r(E2, 1)
off3b = r(U1, 1)-r(E3, 1)
off4b = r(U2, 1)-r(E4, 1)
off5b = r(U1, 1)-r(E5, 1)
off6b = r(U3, 1)-r(E6, 1)

V %= {[1:1:F1], [F1+1:1:F2], [F2+1:1:F3], [F3+1:1:U1], [U1+1:1:U2], [U2+1:1:U3]};
Vmap %= <<{[1:1:F1]} -> 0*x+1, {[F1+1:1:F2]} -> 0*x+2, {[F2+1:1:F3]} -> 0*x+3
  , {[F3+1:1:U1]} -> 0*x+10, {[U1+1:1:U2]} -> 0*x+11, {[U2+1:1:U3]} -> 0*x+12>>;
map1 %= <<{[1:1:E1]} -> 1*x+off1d, {[E1+1:1:E2]} -> 1*x+off2d, {[E2+1:1:E3]} -> 1*x+off3d
  , {[E3+1:1:E4]} -> 1*x+off4d, {[E4+1:1:E5]} -> 1*x+off5d, {[E5+1:1:E6]} -> 1*x+off6d>>;
map2 %= <<{[1:1:E1]} -> 1*x+off1b, {[E1+1:1:E2]} -> 1*x+off2b, {[E2+1:1:E3]} -> 1*x+off3b
  , {[E3+1:1:E4]} -> 1*x+off4b, {[E4+1:1:E5]} -> 1*x+off5b, {[E5+1:1:E6]} -> 1*x+off6b>>;
Emap %= <<{[1:1:E1]} -> 0*x+1, {[E1+1:1:E2]} -> 0*x+2, {[E2+1:1:E3]} -> 0*x+3
  , {[E3+1:1:E4]} -> 0*x+4, {[E4+1:1:E5]} -> 0*x+5, {[E5+1:1:E6]} -> 0*x+6>>;

matchSCCTS(
V %= {[1:1:F1], [F1+1:1:F2], [F2+1:1:F3], [F3+1:1:U1], [U1+1:1:U2], [U2+1:1:U3]};
Vmap %= <<{[1:1:F1]} -> 0*x+1, {[F1+1:1:F2]} -> 0*x+2, {[F2+1:1:F3]} -> 0*x+3
  , {[F3+1:1:U1]} -> 0*x+10, {[U1+1:1:U2]} -> 0*x+11, {[U2+1:1:U3]} -> 0*x+12>>;
map1 %= <<{[1:1:E1]} -> 1*x+off1d, {[E1+1:1:E2]} -> 1*x+off2d, {[E2+1:1:E3]} -> 1*x+off3d
  , {[E3+1:1:E4]} -> 1*x+off4d, {[E4+1:1:E5]} -> 1*x+off5d, {[E5+1:1:E6]} -> 1*x+off6d>>;
map2 %= <<{[1:1:E1]} -> 1*x+off1b, {[E1+1:1:E2]} -> 1*x+off2b, {[E2+1:1:E3]} -> 1*x+off3b
  , {[E3+1:1:E4]} -> 1*x+off4b, {[E4+1:1:E5]} -> 1*x+off5b, {[E5+1:1:E6]} -> 1*x+off6b>>;
Emap %= <<{[1:1:E1]} -> 0*x+1, {[E1+1:1:E2]} -> 0*x+2, {[E2+1:1:E3]} -> 0*x+3
  , {[E3+1:1:E4]} -> 0*x+4, {[E4+1:1:E5]} -> 0*x+5, {[E5+1:1:E6]} -> 0*x+6>>;
, 1, 6
)
